CREATE TABLE USERS (
		 IDUSER INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
		 USERNAME varchar(20) NOT NULL,
		 PASSWORD varchar(255) NOT NULL,
		 ROLE varchar(15) NOT NULL,
		 CONSTRAINT PK_USERID PRIMARY KEY (IDUSER),
		 CONSTRAINT UniqueName UNIQUE(USERNAME)
		); 
	
DROP TABLE LINHASDEFATURA;	
DROP TABLE FATURA;	
DROP TABLE PRODUTO;		
DROP TABLE SUBCATEGORIA;		
DROP TABLE CATEGORIA;
DROP TABLE EMPREGADO;
		

CREATE TABLE EMPREGADO (
IdEmpregado int NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), 
IdUser int,
Nome varchar(120),
Cargo varchar(30), 
DataAdmissao Date,
DateNascimento Date,
Telemovel int,
NIF int,
CONSTRAINT PK_Empregado PRIMARY KEY (IdEmpregado),
CONSTRAINT FK_User FOREIGN KEY (IdUser)
REFERENCES USERS(IDUSER));

CREATE TABLE CATEGORIA (
IdCategoria int NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), 
Descricao varchar(120),
CONSTRAINT PK_Categoria PRIMARY KEY (IdCategoria));

CREATE TABLE SUBCATEGORIA (
IdSubCategoria int NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
IdCategoria int, 
Descricao varchar(120),
CONSTRAINT PK_SubCategoria PRIMARY KEY (IdSubCategoria),
CONSTRAINT FK_Categoria FOREIGN KEY (IdCategoria)
REFERENCES CATEGORIA(IdCategoria));


CREATE TABLE PRODUTO (
IdProduto int NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), 
Nome varchar(120), 
Descricao varchar(120),
IdEmpregadoCriacao int,
IdCategoria int, 
IdSubcategoria int, 
Valor int,
CONSTRAINT PK_Produto PRIMARY KEY (IdProduto),
CONSTRAINT FK_Empregado FOREIGN KEY (IdEmpregadoCriacao)
REFERENCES EMPREGADO(IdEmpregado),
CONSTRAINT FK_CategoriaProduto FOREIGN KEY (IdCategoria)
REFERENCES CATEGORIA(IdCategoria),
CONSTRAINT FK_SubcategoriaProduto FOREIGN KEY (IdSubcategoria)
REFERENCES SUBCATEGORIA(IdSubCategoria));


CREATE TABLE FATURA (
IdFatura int NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1), 
DataHora TimeStamp,
IdEmpregado int,
CONSTRAINT PK_Fatura PRIMARY KEY (IdFatura),
CONSTRAINT FK_EmpregadoFatura FOREIGN KEY (IdEmpregado)
REFERENCES EMPREGADO(IdEmpregado));

CREATE TABLE LINHASDEFATURA (
IdLinhaFatura int NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1),
IdFatura int NOT NULL, 
IdProduto int NOT NULL,
Quantidade int,
Valor int,
CONSTRAINT PK_LinhaFatura PRIMARY KEY (IdLinhaFatura),
CONSTRAINT FK_Fatura FOREIGN KEY (IdFatura)
REFERENCES FATURA(IdFatura),
CONSTRAINT FK_ProdutoLinhaFatura FOREIGN KEY (IdProduto)
REFERENCES PRODUTO(IdProduto)
);

ALTER TABLE produto add quantidade int;